import React, { useState } from 'react';
import { CheckCircle, Circle, ChevronDown, ChevronRight, Copy, Check } from 'lucide-react';

const FXTradeSetup = () => {
  const [expandedSections, setExpandedSections] = useState({});
  const [copiedCode, setCopiedCode] = useState(null);

  const toggleSection = (section) => {
    setExpandedSections(prev => ({
      ...prev,
      [section]: !prev[section]
    }));
  };

  const copyToClipboard = (text, id) => {
    navigator.clipboard.writeText(text);
    setCopiedCode(id);
    setTimeout(() => setCopiedCode(null), 2000);
  };

  const CodeBlock = ({ code, id, language = 'bash' }) => (
    <div className="relative bg-gray-900 rounded-lg p-4 my-3">
      <button
        onClick={() => copyToClipboard(code, id)}
        className="absolute top-2 right-2 p-2 bg-gray-800 hover:bg-gray-700 rounded transition-colors"
      >
        {copiedCode === id ? <Check size={16} className="text-green-400" /> : <Copy size={16} className="text-gray-400" />}
      </button>
      <pre className="text-sm text-gray-100 overflow-x-auto pr-12">
        <code>{code}</code>
      </pre>
    </div>
  );

  const Section = ({ title, children, id }) => (
    <div className="border border-gray-200 rounded-lg mb-4">
      <button
        onClick={() => toggleSection(id)}
        className="w-full flex items-center justify-between p-4 hover:bg-gray-50 transition-colors"
      >
        <h3 className="text-lg font-semibold text-gray-800">{title}</h3>
        {expandedSections[id] ? <ChevronDown size={20} /> : <ChevronRight size={20} />}
      </button>
      {expandedSections[id] && (
        <div className="p-4 pt-0 border-t border-gray-200">
          {children}
        </div>
      )}
    </div>
  );

  return (
    <div className="max-w-4xl mx-auto p-6 bg-white">
      <div className="mb-8">
        <h1 className="text-3xl font-bold text-gray-900 mb-2">Belyfted FX Trade API</h1>
        <p className="text-gray-600">Complete Laravel 11 setup guide for the Foreign Exchange Trade API</p>
      </div>

      <Section title="1. Initial Laravel Setup" id="setup">
        <p className="mb-3 text-gray-700">Create a new Laravel 11 project and set up the database:</p>

        <CodeBlock id="laravel-install" code={`# Create new Laravel project
composer create-project laravel/laravel belyfted-fx-trade-api
cd belyfted-fx-trade-api

# Install Laravel Sanctum
composer require laravel/sanctum
php artisan vendor:publish --provider="Laravel\\Sanctum\\SanctumServiceProvider"

# Install additional dependencies
composer require --dev pestphp/pest
composer require --dev pestphp/pest-plugin-laravel
php artisan pest:install`} />

        <p className="mb-3 text-gray-700 mt-4">Configure your .env file:</p>
        <CodeBlock id="env-config" code={`DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=fx_trade_api
DB_USERNAME=your_username
DB_PASSWORD=your_password

CACHE_DRIVER=redis
QUEUE_CONNECTION=redis
SESSION_DRIVER=redis`} />
      </Section>

      <Section title="2. Database Migrations" id="migrations">
        <p className="mb-3 text-gray-700">Create all required migrations:</p>

        <CodeBlock id="create-migrations" code={`php artisan make:migration create_accounts_table
php artisan make:migration create_trades_table
php artisan make:migration create_market_rates_table
php artisan make:migration create_audit_logs_table`} />

        <p className="mb-3 text-gray-700 mt-4">Accounts migration:</p>
        <CodeBlock id="accounts-migration" language="php" code={`<?php
// database/migrations/xxxx_create_accounts_table.php
use Illuminate\\Database\\Migrations\\Migration;
use Illuminate\\Database\\Schema\\Blueprint;
use Illuminate\\Support\\Facades\\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::create('accounts', function (Blueprint $table) {
            $table->id();
            $table->foreignId('user_id')->constrained()->onDelete('cascade');
            $table->string('name');
            $table->string('currency', 3);
            $table->decimal('balance', 18, 8)->default(0);
            $table->enum('status', ['active', 'inactive', 'suspended'])->default('active');
            $table->timestamps();

            $table->index(['user_id', 'currency']);
            $table->index('status');
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('accounts');
    }
};`} />

        <p className="mb-3 text-gray-700 mt-4">Trades migration:</p>
        <CodeBlock id="trades-migration" language="php" code={`<?php
// database/migrations/xxxx_create_trades_table.php
use Illuminate\\Database\\Migrations\\Migration;
use Illuminate\\Database\\Schema\\Blueprint;
use Illuminate\\Support\\Facades\\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::create('trades', function (Blueprint $table) {
            $table->id();
            $table->foreignId('user_id')->constrained()->onDelete('cascade');
            $table->foreignId('from_account_id')->constrained('accounts');
            $table->foreignId('to_account_id')->nullable()->constrained('accounts');
            $table->string('from_currency', 3);
            $table->string('to_currency', 3);
            $table->decimal('from_amount', 18, 8);
            $table->decimal('to_amount', 18, 8);
            $table->decimal('rate', 18, 8);
            $table->enum('side', ['BUY', 'SELL']);
            $table->enum('status', ['PENDING', 'EXECUTED', 'FAILED', 'CANCELLED'])->default('PENDING');
            $table->string('client_order_id')->unique()->nullable();
            $table->timestamp('executed_at')->nullable();
            $table->timestamps();

            $table->index(['user_id', 'status']);
            $table->index('from_account_id');
            $table->index('to_account_id');
            $table->index('client_order_id');
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('trades');
    }
};`} />

        <p className="mb-3 text-gray-700 mt-4">Market rates migration:</p>
        <CodeBlock id="rates-migration" language="php" code={`<?php
// database/migrations/xxxx_create_market_rates_table.php
use Illuminate\\Database\\Migrations\\Migration;
use Illuminate\\Database\\Schema\\Blueprint;
use Illuminate\\Support\\Facades\\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::create('market_rates', function (Blueprint $table) {
            $table->id();
            $table->string('pair', 7);
            $table->string('base_currency', 3);
            $table->string('quote_currency', 3);
            $table->decimal('rate', 18, 8);
            $table->decimal('bid', 18, 8)->nullable();
            $table->decimal('ask', 18, 8)->nullable();
            $table->timestamps();

            $table->unique('pair');
            $table->index(['base_currency', 'quote_currency']);
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('market_rates');
    }
};`} />

        <p className="mb-3 text-gray-700 mt-4">Audit logs migration:</p>
        <CodeBlock id="audit-migration" language="php" code={`<?php
// database/migrations/xxxx_create_audit_logs_table.php
use Illuminate\\Database\\Migrations\\Migration;
use Illuminate\\Database\\Schema\\Blueprint;
use Illuminate\\Support\\Facades\\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::create('audit_logs', function (Blueprint $table) {
            $table->id();
            $table->foreignId('user_id')->nullable()->constrained()->onDelete('set null');
            $table->string('action');
            $table->string('entity_type');
            $table->unsignedBigInteger('entity_id')->nullable();
            $table->json('old_values')->nullable();
            $table->json('new_values')->nullable();
            $table->string('ip_address', 45)->nullable();
            $table->text('user_agent')->nullable();
            $table->timestamps();

            $table->index(['entity_type', 'entity_id']);
            $table->index(['user_id', 'created_at']);
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('audit_logs');
    }
};`} />
      </Section>

      <Section title="3. Models and Relationships" id="models">
        <p className="mb-3 text-gray-700">Create Eloquent models:</p>

        <CodeBlock id="create-models" code={`php artisan make:model Account
php artisan make:model Trade
php artisan make:model MarketRate
php artisan make:model AuditLog`} />

        <p className="mb-3 text-gray-700 mt-4">Account Model:</p>
        <CodeBlock id="account-model" language="php" code={`<?php
// app/Models/Account.php
namespace App\\Models;

use Illuminate\\Database\\Eloquent\\Factories\\HasFactory;
use Illuminate\\Database\\Eloquent\\Model;
use Illuminate\\Database\\Eloquent\\Relations\\BelongsTo;
use Illuminate\\Database\\Eloquent\\Relations\\HasMany;

class Account extends Model
{
    use HasFactory;

    protected $fillable = [
        'user_id',
        'name',
        'currency',
        'balance',
        'status',
    ];

    protected $casts = [
        'balance' => 'decimal:8',
    ];

    public function user(): BelongsTo
    {
        return $this->belongsTo(User::class);
    }

    public function tradesFrom(): HasMany
    {
        return $this->hasMany(Trade::class, 'from_account_id');
    }

    public function tradesTo(): HasMany
    {
        return $this->hasMany(Trade::class, 'to_account_id');
    }

    public function hasSufficientBalance(float $amount): bool
    {
        return $this->balance >= $amount;
    }

    public function isActive(): bool
    {
        return $this->status === 'active';
    }
}`} />

        <p className="mb-3 text-gray-700 mt-4">Trade Model:</p>
        <CodeBlock id="trade-model" language="php" code={`<?php
// app/Models/Trade.php
namespace App\\Models;

use Illuminate\\Database\\Eloquent\\Factories\\HasFactory;
use Illuminate\\Database\\Eloquent\\Model;
use Illuminate\\Database\\Eloquent\\Relations\\BelongsTo;

class Trade extends Model
{
    use HasFactory;

    protected $fillable = [
        'user_id',
        'from_account_id',
        'to_account_id',
        'from_currency',
        'to_currency',
        'from_amount',
        'to_amount',
        'rate',
        'side',
        'status',
        'client_order_id',
        'executed_at',
    ];

    protected $casts = [
        'from_amount' => 'decimal:8',
        'to_amount' => 'decimal:8',
        'rate' => 'decimal:8',
        'executed_at' => 'datetime',
    ];

    public function user(): BelongsTo
    {
        return $this->belongsTo(User::class);
    }

    public function fromAccount(): BelongsTo
    {
        return $this->belongsTo(Account::class, 'from_account_id');
    }

    public function toAccount(): BelongsTo
    {
        return $this->belongsTo(Account::class, 'to_account_id');
    }
}`} />
      </Section>

      <Section title="4. Repository Pattern" id="repositories">
        <p className="mb-3 text-gray-700">Create repository structure:</p>

        <CodeBlock id="create-repos" code={`mkdir -p app/Repositories/Contracts
mkdir -p app/Repositories`} />

        <p className="mb-3 text-gray-700 mt-4">Account Repository Interface:</p>
        <CodeBlock id="account-repo-interface" language="php" code={`<?php
// app/Repositories/Contracts/AccountRepositoryInterface.php
namespace App\\Repositories\\Contracts;

use App\\Models\\Account;
use Illuminate\\Support\\Collection;

interface AccountRepositoryInterface
{
    public function findById(int $id): ?Account;
    public function findByUserAndId(int $userId, int $accountId): ?Account;
    public function getUserAccounts(int $userId): Collection;
    public function lockForUpdate(int $id): ?Account;
    public function updateBalance(int $accountId, float $newBalance): bool;
}`} />

        <p className="mb-3 text-gray-700 mt-4">Account Repository Implementation:</p>
        <CodeBlock id="account-repo" language="php" code={`<?php
// app/Repositories/AccountRepository.php
namespace App\\Repositories;

use App\\Models\\Account;
use App\\Repositories\\Contracts\\AccountRepositoryInterface;
use Illuminate\\Support\\Collection;

class AccountRepository implements AccountRepositoryInterface
{
    public function findById(int $id): ?Account
    {
        return Account::find($id);
    }

    public function findByUserAndId(int $userId, int $accountId): ?Account
    {
        return Account::where('user_id', $userId)
            ->where('id', $accountId)
            ->first();
    }

    public function getUserAccounts(int $userId): Collection
    {
        return Account::where('user_id', $userId)
            ->orderBy('currency')
            ->get();
    }

    public function lockForUpdate(int $id): ?Account
    {
        return Account::where('id', $id)->lockForUpdate()->first();
    }

    public function updateBalance(int $accountId, float $newBalance): bool
    {
        return Account::where('id', $accountId)
            ->update(['balance' => $newBalance]);
    }
}`} />

        <p className="mb-3 text-gray-700 mt-4">Trade Repository:</p>
        <CodeBlock id="trade-repo" language="php" code={`<?php
// app/Repositories/TradeRepository.php
namespace App\\Repositories;

use App\\Models\\Trade;
use Illuminate\\Support\\Collection;

class TradeRepository
{
    public function create(array $data): Trade
    {
        return Trade::create($data);
    }

    public function findByClientOrderId(string $clientOrderId): ?Trade
    {
        return Trade::where('client_order_id', $clientOrderId)->first();
    }

    public function getUserTrades(int $userId, int $perPage = 20)
    {
        return Trade::where('user_id', $userId)
            ->with(['fromAccount', 'toAccount'])
            ->orderByDesc('created_at')
            ->paginate($perPage);
    }

    public function findById(int $id): ?Trade
    {
        return Trade::with(['fromAccount', 'toAccount'])->find($id);
    }
}`} />
      </Section>

      <Section title="5. Service Layer" id="services">
        <p className="mb-3 text-gray-700">Create the core trade execution service:</p>

        <CodeBlock id="create-services" code={`mkdir -p app/Services
mkdir -p app/DTOs`} />

        <p className="mb-3 text-gray-700 mt-4">Trade DTO:</p>
        <CodeBlock id="trade-dto" language="php" code={`<?php
// app/DTOs/TradeDTO.php
namespace App\\DTOs;

class TradeDTO
{
    public function __construct(
        public readonly int $userId,
        public readonly int $fromAccountId,
        public readonly ?int $toAccountId,
        public readonly string $fromCurrency,
        public readonly string $toCurrency,
        public readonly float $fromAmount,
        public readonly string $side,
        public readonly ?string $clientOrderId = null,
    ) {}

    public static function fromArray(array $data): self
    {
        return new self(
            userId: $data['user_id'],
            fromAccountId: $data['from_account_id'],
            toAccountId: $data['to_account_id'] ?? null,
            fromCurrency: $data['from_currency'],
            toCurrency: $data['to_currency'],
            fromAmount: (float) $data['from_amount'],
            side: $data['side'],
            clientOrderId: $data['client_order_id'] ?? null,
        );
    }
}`} />

        <p className="mb-3 text-gray-700 mt-4">Market Rate Service:</p>
        <CodeBlock id="market-service" language="php" code={`<?php
// app/Services/MarketRateService.php
namespace App\\Services;

use App\\Models\\MarketRate;

class MarketRateService
{
    public function getCurrentRate(string $fromCurrency, string $toCurrency): float
    {
        $pair = "{$fromCurrency}/{$toCurrency}";

        $marketRate = MarketRate::where('pair', $pair)->first();

        if ($marketRate) {
            return (float) $marketRate->rate;
        }

        $reversePair = "{$toCurrency}/{$fromCurrency}";
        $reverseRate = MarketRate::where('pair', $reversePair)->first();

        if ($reverseRate) {
            return 1 / (float) $reverseRate->rate;
        }

        return $this->simulateRate($fromCurrency, $toCurrency);
    }

    private function simulateRate(string $from, string $to): float
    {
        $baseRates = [
            'GBP/EUR' => 1.145,
            'GBP/USD' => 1.268,
            'EUR/USD' => 1.107,
            'USD/NGN' => 1650.50,
            'GBP/NGN' => 2093.25,
        ];

        $pair = "{$from}/{$to}";
        $baseRate = $baseRates[$pair] ?? 1.0;

        $fluctuation = ($baseRate * 0.005) * (mt_rand(-100, 100) / 100);

        return round($baseRate + $fluctuation, 8);
    }
}`} />

        <p className="mb-3 text-gray-700 mt-4">Audit Log Service:</p>
        <CodeBlock id="audit-service" language="php" code={`<?php
// app/Services/AuditLogService.php
namespace App\\Services;

use App\\Models\\AuditLog;

class AuditLogService
{
    public function log(
        ?int $userId,
        string $action,
        string $entityType,
        ?int $entityId = null,
        ?array $oldValues = null,
        ?array $newValues = null
    ): AuditLog {
        return AuditLog::create([
            'user_id' => $userId,
            'action' => $action,
            'entity_type' => $entityType,
            'entity_id' => $entityId,
            'old_values' => $oldValues,
            'new_values' => $newValues,
            'ip_address' => request()->ip(),
            'user_agent' => request()->userAgent(),
        ]);
    }
}`} />

        <p className="mb-3 text-gray-700 mt-4">Execute Trade Service:</p>
        <CodeBlock id="execute-trade-service" language="php" code={`<?php
// app/Services/ExecuteTradeService.php
namespace App\\Services;

use App\\DTOs\\TradeDTO;
use App\\Models\\Trade;
use App\\Repositories\\AccountRepository;
use App\\Repositories\\TradeRepository;
use Illuminate\\Support\\Facades\\DB;
use Illuminate\\Validation\\ValidationException;

class ExecuteTradeService
{
    public function __construct(
        private readonly AccountRepository $accountRepository,
        private readonly TradeRepository $tradeRepository,
        private readonly MarketRateService $marketRateService,
        private readonly AuditLogService $auditLogService,
    ) {}

    public function execute(TradeDTO $dto): Trade
    {
        if ($dto->clientOrderId) {
            $existingTrade = $this->tradeRepository->findByClientOrderId($dto->clientOrderId);
            if ($existingTrade) {
                return $existingTrade;
            }
        }

        return DB::transaction(function () use ($dto) {
            $fromAccount = $this->accountRepository->lockForUpdate($dto->fromAccountId);

            if (!$fromAccount) {
                throw ValidationException::withMessages([
                    'from_account_id' => ['Account not found.']
                ]);
            }

            if ($fromAccount->user_id !== $dto->userId) {
                throw ValidationException::withMessages([
                    'from_account_id' => ['You do not own this account.']
                ]);
            }

            if (!$fromAccount->isActive()) {
                throw ValidationException::withMessages([
                    'from_account_id' => ['Account is not active.']
                ]);
            }

            if (!$fromAccount->hasSufficientBalance($dto->fromAmount)) {
                throw ValidationException::withMessages([
                    'from_amount' => ['Insufficient balance.']
                ]);
            }

            $toAccount = null;
            if ($dto->toAccountId) {
                $toAccount = $this->accountRepository->lockForUpdate($dto->toAccountId);

                if (!$toAccount || $toAccount->user_id !== $dto->userId) {
                    throw ValidationException::withMessages([
                        'to_account_id' => ['Invalid destination account.']
                    ]);
                }
            }

            $rate = $this->marketRateService->getCurrentRate($dto->fromCurrency, $dto->toCurrency);
            $toAmount = $dto->fromAmount * $rate;

            $trade = $this->tradeRepository->create([
                'user_id' => $dto->userId,
                'from_account_id' => $dto->fromAccountId,
                'to_account_id' => $dto->toAccountId,
                'from_currency' => $dto->fromCurrency,
                'to_currency' => $dto->toCurrency,
                'from_amount' => $dto->fromAmount,
                'to_amount' => $toAmount,
                'rate' => $rate,
                'side' => $dto->side,
                'status' => 'EXECUTED',
                'client_order_id' => $dto->clientOrderId,
                'executed_at' => now(),
            ]);

            $this->accountRepository->updateBalance(
                $fromAccount->id,
                $fromAccount->balance - $dto->fromAmount
            );

            if ($toAccount) {
                $this->accountRepository->updateBalance(
                    $toAccount->id,
                    $toAccount->balance + $toAmount
                );
            }

            $this->auditLogService->log(
                userId: $dto->userId,
                action: 'trade_executed',
                entityType: 'trade',
                entityId: $trade->id,
                newValues: $trade->toArray()
            );

            return $trade->fresh(['fromAccount', 'toAccount']);
        });
    }
}`} />
      </Section>

      <Section title="6. Controllers and Routes" id="controllers">
        <p className="mb-3 text-gray-700">Create API controllers:</p>

        <CodeBlock id="create-controllers" code={`php artisan make:controller Api/AuthController
php artisan make:controller Api/AccountController
php artisan make:controller Api/TradeController
php artisan make:controller Api/MarketRateController`} />

        <p className="mb-3 text-gray-700 mt-4">Auth Controller:</p>
        <CodeBlock id="auth-controller" language="php" code={`<?php
// app/Http/Controllers/Api/AuthController.php
namespace App\\Http\\Controllers\\Api;

use App\\Http\\Controllers\\Controller;
use App\\Models\\User;
use Illuminate\\Http\\JsonResponse;
use Illuminate\\Http\\Request;
use Illuminate\\Support\\Facades\\Hash;
use Illuminate\\Validation\\ValidationException;

class AuthController extends Controller
{
    public function login(Request $request): JsonResponse
    {
        $request->validate([
            'email' => 'required|email',
            'password' => 'required',
        ]);

        $user = User::where('email', $request->email)->first();

        if (!$user || !Hash::check($request->password, $user->password)) {
            throw ValidationException::withMessages([
                'email' => ['The provided credentials are incorrect.'],
            ]);
        }

        $token = $user->createToken('api-token')->plainTextToken;

        return response()->json([
            'token' => $token,
            'user' => $user,
        ]);
    }

    public function register(Request $request): JsonResponse
    {
        $validated = $request->validate([
            'name' => 'required|string|max:255',
            'email' => 'required|string|email|max:255|unique:users',
            'password' => 'required|string|min:8|confirmed',
        ]);

        $user = User::create([
            'name' => $validated['name'],
            'email' => $validated['email'],
            'password' => Hash::make($validated['password']),
        ]);

        $token = $user->createToken('api-token')->plainTextToken;

        return response()->json([
            'token' => $token,
            'user' => $user,
        ], 201);
    }
}`} />

        <p className="mb-3 text-gray-700 mt-4">Trade Controller:</p>
        <CodeBlock id="trade-controller" language="php" code={`<?php
// app/Http/Controllers/Api/TradeController.php
namespace App\\Http\\Controllers\\Api;

use App\\DTOs\\TradeDTO;
use App\\Http\\Controllers\\Controller;
use App\\Http\\Requests\\ExecuteTradeRequest;
use App\\Services\\ExecuteTradeService;
use App\\Repositories\\TradeRepository;
use Illuminate\\Http\\JsonResponse;
use Illuminate\\Http\\Request;

class TradeController extends Controller
{
    public function __construct(
        private readonly ExecuteTradeService $executeTradeService,
        private readonly TradeRepository $tradeRepository,
    ) {}

    public function execute(ExecuteTradeRequest $request): JsonResponse
    {
        try {
            $dto = TradeDTO::fromArray([
                ...$request->validated(),
                'user_id' => $request->user()->id,
            ]);

            $trade = $this->executeTradeService->execute($dto);

            return response()->json([
                'trade_id' => $trade->id,
                'from_account_id' => $trade->from_account_id,
                'to_account_id' => $trade->to_account_id,
                'from_currency' => $trade->from_currency,
                'to_currency' => $trade->to_currency,
                'from_amount' => $trade->from_amount,
                'to_amount' => $trade->to_amount,
                'rate' => $trade->rate,
                'status' => $trade->status,
                'executed_at' => $trade->executed_at,
            ], 201);
        } catch (ValidationException $e) {
            return response()->json([
                'message' => 'Validation failed',
                'errors' => $e->errors(),
            ], 422);
        }
    }

    public function index(Request $request): JsonResponse
    {
        $trades = $this->tradeRepository->getUserTrades($request->user()->id);
        return response()->json($trades);
    }

    public function show(Request $request, int $id): JsonResponse
    {
        $trade = $this->tradeRepository->findById($id);

        if (!$trade || $trade->user_id !== $request->user()->id) {
            return response()->json(['message' => 'Trade not found'], 404);
        }

        return response()->json($trade);
    }
}`} />

        <p className="mb-3 text-gray-700 mt-4">Form Request Validation:</p>
        <CodeBlock id="form-request" code={`php artisan make:request ExecuteTradeRequest`} />

        <CodeBlock id="trade-request" language="php" code={`<?php
// app/Http/Requests/ExecuteTradeRequest.php
namespace App\\Http\\Requests;

use Illuminate\\Foundation\\Http\\FormRequest;

class ExecuteTradeRequest extends FormRequest
{
    public function authorize(): bool
    {
        return true;
    }

    public function rules(): array
    {
        return [
            'from_account_id' => ['required', 'integer', 'exists:accounts,id'],
            'to_account_id' => ['nullable', 'integer', 'exists:accounts,id', 'different:from_account_id'],
            'from_currency' => ['required', 'string', 'size:3'],
            'to_currency' => ['required', 'string', 'size:3', 'different:from_currency'],
            'from_amount' => ['required', 'numeric', 'min:0.00000001'],
            'side' => ['required', 'in:BUY,SELL'],
            'client_order_id' => ['nullable', 'string', 'max:255'],
        ];
    }
}`} />

        <p className="mb-3 text-gray-700 mt-4">API Routes:</p>
        <CodeBlock id="api-routes" language="php" code={`<?php
// routes/api.php
use App\\Http\\Controllers\\Api\\AuthController;
use App\\Http\\Controllers\\Api\\AccountController;
use App\\Http\\Controllers\\Api\\TradeController;
use App\\Http\\Controllers\\Api\\MarketRateController;
use Illuminate\\Support\\Facades\\Route;

Route::post('/login', [AuthController::class, 'login']);
Route::post('/register', [AuthController::class, 'register']);

Route::middleware(['auth:sanctum', 'throttle:60,1'])->group(function () {
    Route::get('/accounts', [AccountController::class, 'index']);
    Route::get('/accounts/{id}', [AccountController::class, 'show']);

    Route::get('/market/rate', [MarketRateController::class, 'getRate']);

    Route::middleware('throttle:30,1')->group(function () {
        Route::post('/trades/execute', [TradeController::class, 'execute']);
    });

    Route::get('/trades', [TradeController::class, 'index']);
    Route::get('/trades/{id}', [TradeController::class, 'show']);
});
